<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login with Google</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/dist/umd/supabase.min.js"></script>
</head>

<body>
    <div class="login-container" id="login-container">
        <img src="Variant2.png" alt="Logo" class="login-image">
        <button id="google-login-btn">Login with Google</button>
    </div>

    <script>
        // Supabase client initialization
        const SUPABASE_URL = 'https://jrxpfkrhvnmfkmmjudvy.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpyeHBma3Jodm5tZmttbWp1ZHZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU3NDM4MjMsImV4cCI6MjA1MTMxOTgyM30.JKYX44Ia_yqCAsbWO_WlRCD3f1wPYOXyf7i9Ua-kYig';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Debugging untuk check login session
        async function checkLoggedIn() {
            console.log("Checking session...");
            const { data: { session }, error } = await supabase.auth.getSession();

            if (error) {
                console.error("Error checking session:", error);
                return;
            }

            if (session) {
                console.log("User is logged in:", session.user);
                document.body.innerHTML = `<h1>Welcome, ${session.user.email}</h1>`;
                setTimeout(() => {
                    window.location.href = 'frontend/menu.html';
                }, 3000);
            } else {
                console.log("No active session found.");
            }
        }

        // Debugging untuk tombol Google login
        const googleLoginBtn = document.getElementById('google-login-btn');
        googleLoginBtn.addEventListener('click', async () => {
            console.log("Google login button clicked!");
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: 'http://localhost:5500/frontend/menu.html', // atau sesuai dengan lokasi menu.html
                    },
                });

                if (error) {
                    console.error("Error during login:", error);
                    alert('Failed to login. Please try again.');
                } else {
                    console.log("Login successful:", data);
                }
            } catch (err) {
                console.error("Unexpected error:", err);
            }
        });

        // Jalankan pengecekan session saat halaman dimuat
        checkLoggedIn();
    </script>
</body>

</html>